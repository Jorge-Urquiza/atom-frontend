import{a as g}from"./chunk-5RO43WVG.js";import{$ as U,Ba as O,D as f,H as F,K as A,L as N,M,N as h,aa as S,ba as k,ca as w,d as l,da as b,e as c,ea as E,f as u,fa as B,ga as T,h as I,ha as D,i as p,ia as L,ja as x,la as R,m as s,ma as G,n as o,na as V,pa as _,qa as $,r as y,ra as H,s as a,t as m,u as n,v as d,x as j}from"./chunk-EE7L7KOV.js";var q=(()=>{class e{constructor(i){this.http=i,this.apiUrl=`${g.apiBaseUrl}/auth`}login(i){return this.http.post(`${this.apiUrl}/login`,i)}static{this.\u0275fac=function(t){return new(t||e)(u(h))}}static{this.\u0275prov=l({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var P=(()=>{class e{constructor(i){this.http=i,this.apiUrl=`${g.apiBaseUrl}/users`}create(i){return this.http.post(this.apiUrl,i)}static{this.\u0275fac=function(t){return new(t||e)(u(h))}}static{this.\u0275prov=l({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var ee=e=>({"p-invalid":e});function ie(e,re){e&1&&(m(0,"small",9),f(1," Correo inv\xE1lido "),n())}var z=(()=>{class e{constructor(i,t,r,C,K,Q,W){this.router=i,this.formBuilder=t,this.authService=r,this.userService=C,this.sessionService=K,this.messageService=Q,this.confirmationService=W,this.loading=!1}ngOnInit(){this.loginForm=this.formBuilder.group({email:["",[b.required,b.email]]})}get email(){return this.loginForm.get("email")}onSubmit(){if(this.loginForm.invalid){this.loginForm.markAllAsTouched();return}this.loading=!0;let i=this.loginForm.value;this.attemptLogin(i)}attemptLogin(i){this.authService.login(i).subscribe({next:t=>{let r=t.data.token;this.storeTokenAndNavigate(r,i)},error:t=>{this.loading=!1,console.log("confirmation:",t),t?.error?.message==="User not found"?this.confirmUserCreation(i.email):this.messageService.add({severity:"error",summary:"Error",detail:"Ocurri\xF3 un error inesperado."})}})}confirmUserCreation(i){this.confirmationService.confirm({message:"El usuario no se encuentra registrado. \xBFDeseas crear una cuenta?",header:"Usuario no encontrado",icon:"pi pi-user-plus",acceptLabel:"Si",rejectLabel:"No",acceptButtonStyleClass:"p-button-sucess p-button-text",rejectButtonStyleClass:"p-button-danger p-button-text",acceptIcon:"pi pi-check mr-2",rejectIcon:"pi pi-times mr-2",defaultFocus:"none",accept:()=>{this.registerUserAndLogin(i)}})}registerUserAndLogin(i){this.loading=!0,this.userService.create({email:i}).subscribe({next:()=>{this.attemptLogin({email:i})},error:()=>{this.loading=!1,this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo registrar el usuario."})}})}storeTokenAndNavigate(i,t){this.sessionService.setToken(i),this.sessionService.setEmail(t.email),this.router.navigate(["/tasks"]),this.loading=!1}static{this.\u0275fac=function(t){return new(t||e)(o(U),o(x),o(q),o(P),o(k),o(V),o(G))}}static{this.\u0275cmp=I({type:e,selectors:[["app-auth"]],decls:12,vars:7,consts:[[1,"flex","align-items-center","justify-content-center","min-h-screen","px-3"],[1,"surface-card","p-4","shadow-2","border-round","w-full","sm:w-30rem"],[1,"text-center","mb-4"],[3,"ngSubmit","formGroup"],[1,"field","mb-3"],["for","email"],["id","email","type","email","pInputText","","formControlName","email",1,"w-full",3,"ngClass"],["class","p-error",4,"ngIf"],["pButton","","type","submit","label","Ingresar",1,"w-full",3,"loading","disabled"],[1,"p-error"]],template:function(t,r){t&1&&(d(0,"p-confirmDialog"),m(1,"div",0)(2,"div",1)(3,"h2",2),f(4,"Iniciar Sesi\xF3n"),n(),m(5,"form",3),j("ngSubmit",function(){return r.onSubmit()}),m(6,"div",4)(7,"label",5),f(8,"Correo electr\xF3nico*"),n(),d(9,"input",6),y(10,ie,2,0,"small",7),n(),d(11,"button",8),n()()()),t&2&&(s(5),a("formGroup",r.loginForm),s(4),a("ngClass",F(5,ee,(r.email==null?null:r.email.invalid)&&(r.email==null?null:r.email.touched))),s(),a("ngIf",(r.email==null?null:r.email.invalid)&&(r.email==null?null:r.email.touched)),s(),a("loading",r.loading)("disabled",r.loginForm.invalid||r.loading))},dependencies:[A,N,T,w,E,B,D,L,_,$,H]})}}return e})();var te=[{path:"",component:z}],J=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=p({type:e})}static{this.\u0275inj=c({imports:[S.forChild(te),S]})}}return e})();var Ae=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=p({type:e})}static{this.\u0275inj=c({imports:[M,R,O,J]})}}return e})();export{Ae as AuthModule};
